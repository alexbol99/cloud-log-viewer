(this["webpackJsonpcloud-log-viewer"]=this["webpackJsonpcloud-log-viewer"]||[]).push([[0],{107:function(e,t,n){e.exports=n(168)},112:function(e,t,n){},167:function(e,t,n){},168:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n.n(a),o=n(38),i=n.n(o),c=(n(112),n(9)),u=n.n(c),l=n(11),s=n(10),m=n(84),d=n.n(m),f=n(85),p=n.n(f),g=n(86),h=n(87),v=n.n(h),b=function(e){return r.a.createElement("button",{title:e.title,onClick:e.onClick,className:v.a.Button},e.icon?r.a.createElement(g.a,{icon:e.icon,size:"x",spin:e.spin}):null,e.text)},k=n(88),L=n.n(k),E="https://vm7sirnd04.execute-api.us-east-1.amazonaws.com/test",C=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(E,"/list"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,a=JSON.parse(n.body).keys,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return fetch("".concat(E,"/list/").concat(e))})),e.next=3,Promise.all(n);case 3:return a=e.sent,r=a.map((function(e){return e.json()})),e.next=7,Promise.all(r);case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(E,"/get-presigned-url/").concat(t.name),a=null,e.prev=2,e.next=5,fetch(n);case 5:return r=e.sent,e.next=8,r.json();case 8:o=e.sent,a=o.url,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0.message);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(t);case 2:return n=e.sent,e.abrupt("return",fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:t.src.file}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(E,"/delete"),a=[],e.prev=2,e.next=5,fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:t})});case 5:return r=e.sent,e.next=8,r.json();case 8:o=e.sent,console.log(o.keys),a=o.keys,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),alert("error delete files");case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}(),D=function(e){var t=function(){var t=Object(l.a)(u.a.mark((function t(n){var a,r,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.map((function(e){return y(e)})),r=n.map((function(e){return e.name})),t.prev=2,t.next=5,Promise.all(a);case 5:return o=t.sent,e.onUploadSucceed(r),t.abrupt("return",o);case 10:return t.prev=10,t.t0=t.catch(2),console.log(t.t0),t.abrupt("return",t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement(L.a,{multiple:!0,multipleMaxCount:300,onSuccess:function(e){return t(e)}},(function(e){var t=e.browseFiles;return r.a.createElement(b,{title:"Upload log files",text:"Upload",onClick:t})}))},S=n(89),T=n.n(S);var N,j,_,R,O=function(e){return r.a.createElement("header",{className:T.a.RunningLogsListHeader},r.a.createElement(D,{onUploadSucceed:e.onUploadSucceed}),r.a.createElement(b,{title:"Delete log files",text:"Delete",onClick:e.onDeleteButtonPressed}))},P=n(90),M=n(91),B=n.n(M),A=n(21),F=n.n(A),J=n(92),U=n.n(J),V=function(e){var t=e.children,n=document.getElementById("modal-root"),r=document.createElement("div");return Object(a.useEffect)((function(){return n.appendChild(r),function(){return n.removeChild(r)}}),[r,n]),Object(o.createPortal)(t,r)},W=n(63),z=n.n(W),X=function(e){var t=function(t){"Escape"===t.code&&e.closePopup()},n=function(e){e=e||window.event,N=_-e.clientX,j=R-e.clientY,_=e.clientX,R=e.clientY;var t=e.target;t.style.top=t.offsetTop-j+"px",t.style.left=t.offsetLeft-N+"px"},o=function(e){e.target.onmouseup=null,e.target.onmousemove=null};return Object(a.useEffect)((function(){return document.addEventListener("keydown",t),function(){return document.removeEventListener("keydown",t)}})),e.showPopup?r.a.createElement(V,null,r.a.createElement("div",{id:"backDrop",className:z.a.BackDrop,onClick:function(t){"backDrop"===t.target.id&&e.closePopup()}},r.a.createElement("div",{className:z.a.ModalPopup,onMouseDown:function(e){e=e||window.event,_=e.clientX,R=e.clientY,e.target.onmouseup=o,e.target.onmousemove=n}},r.a.createElement("header",null,e.header),e.children))):null},G=function(e){var t=e.content.split("\n");return r.a.createElement(X,{showPopup:e.showFileContentPopup,closePopup:e.closeFileContentPopup,header:"Log File Content"},r.a.createElement("div",{className:U.a.FileContentPopup},t.map((function(e){return r.a.createElement("p",null,e)}))))};var H=function(e){var t=Object(a.useState)(!1),n=Object(s.a)(t,2),o=n[0],i=n[1],c=Object(a.useRef)();Object(a.useEffect)((function(){e.selected&&u()}));var u=function(){var e=c.current.parentElement.parentElement.getBoundingClientRect(),t=c.current.getBoundingClientRect();t.bottom>e.bottom&&c.current.scrollIntoView(!1),t.top<e.top&&c.current.scrollIntoView(!0)},l=e.selected?F.a.RunningLogListItemClicked:F.a.RunningLogListItem;l=e.batchFailed?"".concat(l," ").concat(F.a.RunningLogListItemFailed):l;var m=e.marked?F.a.RunningLogListItemCheckMarkClicked:F.a.RunningLogListItemCheckMarkNotClicked;return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{className:l,onClick:function(t){t.ctrlKey||t.shiftKey||(t.stopPropagation(),t.preventDefault(),e.itemClicked())},ref:c},r.a.createElement("td",{onClick:function(t){e.selected||(t.ctrlKey||t.shiftKey)&&(t.stopPropagation(),t.preventDefault(),e.checkMarkClicked())}},r.a.createElement("h4",{className:m},"\u2713")),r.a.createElement("td",null,e.data.runningDate),r.a.createElement("td",null,e.data.jobName),r.a.createElement("td",null,e.data.step),r.a.createElement("td",null,e.data.checklist),r.a.createElement("td",{className:F.a.RunningLogListItemNumeric},e.data.actionsNum),r.a.createElement("td",{className:F.a.RunningLogListItemNumeric},e.data.layersNum),r.a.createElement("td",{className:F.a.RunningLogListItemNumeric},e.data.batchJobsNum),r.a.createElement("td",null,e.data.runningTime||"Failed"),r.a.createElement("td",null,r.a.createElement("div",{onClick:function(e){i(!0)}},e.data.key))),o?r.a.createElement(G,{showFileContentPopup:o,closeFileContentPopup:function(){i(!1)},content:e.data.text}):null)};var K=function(e){var t,n;return Object(a.useEffect)((function(){var t=function(t){switch(t.code){case"ArrowDown":t.stopPropagation(),t.preventDefault(),e.selectedIndex<e.logsListData.length-1&&e.logItemClicked(e.selectedIndex+1);break;case"ArrowUp":t.stopPropagation(),t.preventDefault(),e.selectedIndex>0&&e.logItemClicked(e.selectedIndex-1)}};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}})),r.a.createElement("div",null,r.a.createElement(P.a,{dataLength:null===(t=e.logsListData)||void 0===t?void 0:t.length,next:function(){},hasMore:!0},r.a.createElement("table",{className:B.a.RunningLogsListTable},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"3%"}},"\u2713"),r.a.createElement("th",{style:{width:"15%"}},"Running date"),r.a.createElement("th",{style:{width:"22%"}},"Job Name"),r.a.createElement("th",{style:{width:"3%"}},"Step"),r.a.createElement("th",{style:{width:"15%"}},"Checklist"),r.a.createElement("th",{style:{width:"5%"}},"# Actions"),r.a.createElement("th",{style:{width:"5%"}},"# Layers"),r.a.createElement("th",{style:{width:"5%"}},"# ACPs"),r.a.createElement("th",{style:{width:"4%"}},"Running Time"),r.a.createElement("th",{style:{width:"13%"}},"Log File Name"))),r.a.createElement("tbody",null,null===(n=e.logsListData)||void 0===n?void 0:n.map((function(t,n){return r.a.createElement(H,{key:n,data:t,selected:e.selectedIndex===n,marked:t.marked,batchFailed:!!t.errorTime,itemClicked:function(){return e.logItemClicked(n)},checkMarkClicked:function(){return e.checkMarkClicked(n)}})}))))))},Y=n(2);function $(e){var t=null===e||void 0===e?void 0:e.batch[e.batch.length-1].ActNum,n=new Set(null===e||void 0===e?void 0:e.batch.map((function(e){return e.LayerName}))).size;return{runningDate:null===e||void 0===e?void 0:e.runningDate,jobName:null===e||void 0===e?void 0:e.jobName,step:null===e||void 0===e?void 0:e.batch[0].StepName,checklist:null===e||void 0===e?void 0:e.batch[0].ChecklistName,actionsNum:t,layersNum:n,runningTime:null===e||void 0===e?void 0:e.runningTime,batchJobsNum:null===e||void 0===e?void 0:e.batch.length,key:null===e||void 0===e?void 0:e.key,errorTime:null===e||void 0===e?void 0:e.errorTime,text:null===e||void 0===e?void 0:e.text,marked:null===e||void 0===e?void 0:e.marked}}function Q(e,t){return e instanceof Date&&!isNaN(e)&&t instanceof Date&&!isNaN(t)?new Date(t-e).toISOString().substr(11,8):0}var Z=function(e){var t=[];return e.logDataArray.length>0&&(t=e.logDataArray.map((function(e){return $(e)}))),r.a.createElement("div",{className:p.a.RunningLogsList},r.a.createElement(O,{loading:e.loading,onUploadSucceed:e.onUploadSucceed,onDeleteButtonPressed:e.onDeleteButtonPressed,onRefreshButtonPressed:e.onRefreshButtonPressed}),r.a.createElement(K,{logsListData:t,selectedIndex:e.selectedIndex,logItemClicked:e.logItemClicked,checkMarkClicked:e.checkMarkClicked,fetchMoreData:e.onRefreshButtonPressed}))},q=n(174),ee=n(93),te=n.n(ee);var ne=function(e){var t,n={$schema:"https://vega.github.io/schema/vega-lite/v4.json",title:null===(t=e.runData)||void 0===t?void 0:t.jobName,data:{values:e.data},mark:{type:"bar",tooltip:[]},encoding:{x:{type:"temporal",field:"StartDate",timeUnit:"hoursminutesseconds"},x2:{type:"temporal",field:"EndDate",timeUnit:"hoursminutesseconds"},y:{type:"nominal",field:"Index",sort:null},color:{field:"Object"}},width:800,autosize:"fit"};return r.a.createElement("div",{className:te.a.VegaLiteChart},e.data&&e.runData.runningTime?r.a.createElement(q.a,{spec:n,data:e.data}):null)},ae=n(99);function re(e){var t=e.split("\n"),n=function(e){var t=e.filter((function(e){return e.match("time")})),n=Object(Y.a)(t);n.splice(0,1);for(var a,r,o=[],i="",c=0;c<n.length;c++)try{if("Submit Splitter"===(a=JSON.parse(n[c])).message)continue;r=ge(a.time,i),i=r.toDateString(),o.push(Object(ae.a)({utcDate:r},a))}catch(u){return[c,n[c]]}return o}(t),a=pe(t,n);return{runningDate:ie(n),runningTime:ce(n,a),jobName:oe(t),batch:ue(n),uploadTime:le(n),splitterTime:se(n),acpTime:fe(t,n),mergerTime:me(n),downloadTime:de(n),errorTime:a}}function oe(e){return e.filter((function(e){return e.match("Job:")}))[0].split(" ")[1]}function ie(e){return e.filter((function(e){return"Ready for commands"===e.message}))[0].utcDate.toLocaleString()}function ce(e,t){var n=e.filter((function(e){return"Ready for commands"===e.message}))[0].utcDate,a=e.filter((function(e){return"Job is ready"===e.message})),r=a.length>0?a[0].utcDate:t;return r?function(e,t){return e instanceof Date&&!isNaN(e)&&t instanceof Date&&!isNaN(t)?new Date(t-e).toISOString().substr(11,8):0}(n,r):""}function ue(e){var t=e.filter((function(e){return"Batch"===e.type})).map((function(e){return e.message.slice(2)})).join("");return JSON.parse(t)}function le(e){return{StartTime:e.find((function(e){return"WebClient"===e.object&&"Job was registered"===e.message})).utcDate,CompleteTime:e.find((function(e){return"WebClient"===e.object&&"After send"===e.message})).utcDate}}function se(e){var t=e.filter((function(e){return"Splitter"===e.object}));return{StartTime:t.find((function(e){return"Splitter started"===e.message})).utcDate,CompleteTime:t.find((function(e){return"End of Split"===e.message})).utcDate}}function me(e){var t=e.filter((function(e){return"Merger"===e.object})),n=t.find((function(e){return"Preparing job for merge"===e.message})),a=t.find((function(e){return"Moving Job to S3"===e.message}));return{StartTime:n?n.utcDate:null,CompleteTime:a?a.utcDate:null}}function de(e){var t=e.find((function(e){return"WebClient"===e.object&&"Download Data"===e.message})),n=e.find((function(e){return"WebClient"===e.object&&"Job is ready"===e.message}));return{StartTime:t?t.utcDate:null,CompleteTime:n?n.utcDate:null}}function fe(e,t){var n=pe(e,t),a=t.filter((function(e){return("Progress"===e.type||"Info"===e.type)&&"ACP"===e.object})).map((function(e){var t=e.message.split(" ");return{Time:e.utcDate,Step:t[0],Stage:t[1].split(":")[1],Index:Number(t[2].split(":")[1])+1}})),r=a.filter((function(e){return"Starting"===e.Step})).map((function(e){return{Stage:e.Stage,Index:e.Index,StartTime:e.Time}})),o=a.filter((function(e){return"Completing"===e.Step})).map((function(e){return{Stage:e.Stage,Index:e.Index,CompleteTime:e.Time}}));return r.map((function(e){var t=o.find((function(t){return t.Stage===e.Stage&&t.Index===e.Index}));return{Stage:e.Stage,Index:e.Index,StartTime:e.StartTime,CompleteTime:t?t.CompleteTime:n,Succeed:!!t}}))}function pe(e,t){var n=t.find((function(e){return"WebClient"===e.object&&"ERROR"===e.type})),a=null;return n&&(a=n.utcDate),a}function ge(e,t){var n=e.split(", ");if(1===n.length)return new Date(t+" "+e);var a=n[0].split("/"),r=Object(s.a)(a,3),o=r[0],i=r[1],c=r[2],u=n[1].split(":"),l=Object(s.a)(u,3),m=l[0],d=l[1],f=l[2];return new Date(Date.UTC(c,o-1,i,m,d,f))}var he=function(e){var t=Object(a.useState)([]),n=Object(s.a)(t,2),o=n[0],i=n[1],c=Object(a.useState)(0),m=Object(s.a)(c,2),f=m[0],p=m[1],g=Object(a.useState)(!1),h=Object(s.a)(g,2),v=h[0],b=(h[1],null),k=null,L=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:return n=e.sent,(a=n.map((function(e){return re(e.text)}))).forEach((function(e,n){return e.key=t[n]})),a.forEach((function(e,t){return e.text=n[t].text})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,r,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t,e.t0){e.next=5;break}return e.next=4,C();case 4:e.t0=e.sent;case 5:return n=e.t0,a=w(n),r=a.slice(0,8),e.next=10,L(r);case 10:c=e.sent,(l=o.concat(c)).sort((function(e,t){return new Date(t.runningDate)-new Date(e.runningDate)})),l.length>0&&(l[0].marked=!0,i(l));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(e){return e.filter((function(e){return!o.some((function(t){return t.key===e}))}))},y=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=o.filter((function(e){return e.marked})).map((function(e){return e.key}))).length){e.next=3;break}return e.abrupt("return");case 3:if(n=t.join("\n"),!window.confirm("File(s) will be deleted:\n ".concat(n))){e.next=11;break}return e.next=8,I(t);case 8:a=e.sent,(r=o.filter((function(e){return!a.includes(e.key)}))).length>0&&(i(r),p(0));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(Object(a.useEffect)((function(){0===o.length&&E()})),o.length>0){var D=o[f];try{b=function(e){var t,n,a=e.batch.map((function(t){var n=e.acpTime.find((function(e){return e.Stage===t.Stage&&e.Index===t.StageIndex}));return{Object:n.Succeed?"Acp":"Acp Failed",Stage:t.Stage,Index:t.Stage+"_"+t.StageIndex,ActNum:t.ActNum,Name:t.AnalysisName,Layer:t.LayerName,ActParam:t.ActParam,BeginNf:t.BeginNf,EndNf:t.EndNf,ContourGroupId:t.ContourGroupId,ContourGroupNum:t.ContourGroupNum,StartDate:n?n.StartTime:"",EndDate:n?n.CompleteTime:"",Time:Q(n.StartTime,n.CompleteTime)}})),r={Object:"Upload",Name:"Upload",Index:-1,StartDate:e.uploadTime.StartTime,EndDate:e.uploadTime.CompleteTime},o={Object:"Splitter",Name:"Splitter",Index:0,StartDate:e.splitterTime.StartTime,EndDate:e.splitterTime.CompleteTime};return e.mergerTime.StartTime&&e.mergerTime.CompleteTime&&(t={Object:"Merger",Name:"Merger",Index:a.length+1,StartDate:e.mergerTime.StartTime,EndDate:e.mergerTime.CompleteTime}),e.downloadTime.StartTime&&e.downloadTime.CompleteTime&&(n={Object:"Download",Name:"Download",Index:a.length+2,StartDate:e.downloadTime.StartTime,EndDate:e.downloadTime.CompleteTime}),a=[r,o].concat(Object(Y.a)(a)),t&&(a=[].concat(Object(Y.a)(a),[t])),n&&(a=[].concat(Object(Y.a)(a),[n])),a}(D)}catch(S){b=null}k=$(D)}return r.a.createElement("main",{className:d.a.MainComponent},r.a.createElement(Z,{logDataArray:o,selectedIndex:f,loading:v,logItemClicked:function(e){var t=o.slice();t.forEach((function(t,n){return t.marked=n===e})),i(t),p(e)},checkMarkClicked:function(e){if(e!==f){var t=o.slice();t.forEach((function(t,n){return n===e?t.marked=!t.marked:t.marked})),i(t)}},onUploadSucceed:function(e){E(e)},onDeleteButtonPressed:y,onRefreshButtonPressed:function(){E()}}),r.a.createElement(ne,{data:b,runData:k}))};n(167);var ve=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"content"},r.a.createElement("h1",null,"Cloud Log Viewer"),r.a.createElement("hr",null),r.a.createElement(he,null),r.a.createElement("hr",null)),r.a.createElement("footer",{className:"footer"},r.a.createElement("p",{style:{fontSize:"12px"}},"Alex Bol 2020")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},21:function(e,t,n){e.exports={RunningLogListItem:"RunningLogListItem_RunningLogListItem__wcmB-",RunningLogListItemClicked:"RunningLogListItem_RunningLogListItemClicked__2euIm",RunningLogListItemFailed:"RunningLogListItem_RunningLogListItemFailed__sXOJI",RunningLogListItemNumeric:"RunningLogListItem_RunningLogListItemNumeric__28nyp",RunningLogListItemClickable:"RunningLogListItem_RunningLogListItemClickable__1XJdG",RunningLogListItemCheckMarkClicked:"RunningLogListItem_RunningLogListItemCheckMarkClicked__1BOa9",RunningLogListItemCheckMarkNotClicked:"RunningLogListItem_RunningLogListItemCheckMarkNotClicked__2ypBQ"}},63:function(e,t,n){e.exports={BackDrop:"ModalPopup_BackDrop__3oXJD",ModalPopup:"ModalPopup_ModalPopup__3TsOV",fadeIn:"ModalPopup_fadeIn__1BHZf"}},84:function(e,t,n){e.exports={MainComponent:"MainComponent_MainComponent__1UCA3"}},85:function(e,t,n){e.exports={RunningLogsList:"RunningLogsList_RunningLogsList__1jWMA"}},87:function(e,t,n){e.exports={Button:"Button_Button__3h9Fb",Icon:"Button_Icon__c_IsA"}},89:function(e,t,n){e.exports={RunningLogsListHeader:"RunningLogsListHeader_RunningLogsListHeader__2REzz"}},91:function(e,t,n){e.exports={RunningLogsListTable:"RunningLogsListTable_RunningLogsListTable__3tUhi",fadeIn:"RunningLogsListTable_fadeIn__1fouu"}},92:function(e,t,n){e.exports={FileContentPopup:"FileContentPopup_FileContentPopup__1wTAX"}},93:function(e,t,n){e.exports={VegaLiteChart:"VegaLiteChart_VegaLiteChart__3452l"}}},[[107,1,2]]]);
//# sourceMappingURL=main.d713b336.chunk.js.map